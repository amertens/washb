---
title: "washb-package-vignette"
author: "Andrew Mertens"
date: "`r Sys.Date()`"
output: 
  html_document:
    mode: selfcontained
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: true
      smooth_scroll: true
vignette: >
  %\VignetteIndexEntry{washb-package-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---


```{r set-options, echo=FALSE, cache=FALSE}
options(width = 300)
options(scipen=20)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Vignette overview  
  
#### WASH Benefits Bangladesh primary outcome analysis using the washb R package functions.  
  
Calculates unadjusted and adjusted differences in diarrheal disease and length-for-age z-score between treatment arms for pre-specified hypothesis 1 (Treatment arms vs. Control arm), and for unspecified subgroup analyses (by target child/sibling for diarrhea outcome and by food security status for LAZ ouctome).  
  
####Input files:
 * washb-bangladesh-diar.csv
 * washb-bangladesh-anthro.csv  
 * washb-bangladesh-enrol.csv  

 
####List and description of the functions documented in this vignette:  
 * __washb_prescreen:__  Function to pre-screen adjustment covariates -- restrict to those with a LR test P<0.2.  
 * __washb_permute:__  Conducts a permutation test of the indepdence of Y and tr, conditional on randomization block using the Wilcoxon rank-sum test statistic.
 * __washb_glm:__  Convenience wrapper function to run glm models with robust standard errors for unadjusted and adjusted estimates.
 * __washb_means:__   Means estimated with robust standard errors for the WASH Benefits trials. Calculate means for a variable along with robust sandwich SEs and 95% confidence intervals that account for clustering within id.
 * __sandwichSE__  
 * __washb_ttest:__  Wrapper function to call the paired t-test for two different arms of the study.  
 * __washb_mh:__  Estimates the Mantel-Haenszel prevalence ratio. Note: strata with no outcomes (i.e., missing PR) are dropped. This is consistent with a fixed-effects regression analysis, in which those strata would not contribute to the estimates. The arguments Y,tr,strat, below need to be from the same dataset.  
 * __washb_lincom:__ Function to get Estimates, SEs, CIs, and P-values for Pr>|Z| from a linear combination of regression coefficients.
  
  
####Relationships among functions:  
 * __washb\_glm__ calls __washb_prescreen__, and then only covariates with a p-value>0.2 are included in the adjustment set.  
 * __washb\_glm__ uses __sandwichSE__ to estimate sandwich-based robust standard errors to account for clustering.  
 * __washb\_glm__ uses __washb\_glmFormat__ to format model output, convert coefficients to risk ratios, and return the variance/covariance matrix and a vestor of dropped observations.
 * __washb\_glm__ uses __washb\_lincom__ to calculate linear combinations of glm coefficients if a subgroup factor V is supplied to the function.
  
 * __washb_means__ uses __sandwichSE__ to estimate sandwich-based robust standard errors to account for clustering.

#R resources
For new users of R, the following sources are helpful learning resources:  
 * [Calendar of UC Berkeley D-Lab workshops](http://dlab.berkeley.edu/event-host/d-lab) (Look for R bootcamps)  
 * [Datacamp: R for SAS, SPSS, and Stata users](https://www.datacamp.com/courses/r-for-sas-spss-and-stata-users-r-tutorial) (This course is for those familiar   with statistical programming who only need to learn R-specific syntax. Great GUI learning interface, and free for introductory course, and academic discount for paid courses.)  
 * [Try R codeschool](http://tryr.codeschool.com/) (An interactive introductory course)  
 * [UCLA Institute For Digital Research and Education: R resources](http://statistics.ats.ucla.edu/stat/r/) (Great source for topic-specific tutorials)  
 * [R -tutor introduction](http://www.r-tutor.com/r-introduction)  
 * [Johns Hopkins Coursera course in R programming](https://www.coursera.org/learn/r-programming)  

  
  
#Package and Data Loading
### Load in required packages:
If you are installing the packages for the first time:
```{r, eval = FALSE, tidy=TRUE}
    install.packages("sandwich")
    install.packages("lmtest")
    install.packages("coin")
    install.packages("plyr")
    install.packages("metafor")
```
  
Once packages are installed for the first time, they will be loaded along with the `washb` package when the following code is run:

```{r , results = "hide"}
library(washb)
```

###Package documentation
Use `??washb` to see full list of package documentation, or use `?(function name)` to see help documentation for any specific package. For example, `?washb_glm` returns the help page for the washb\_glm function.


###Clean data  
The data in this vignette is contained in 3 files, included in the package:  
1.  __washb_bd_enrol.Rdata__, an R file of Bangladesh enrollment characteristics  
2.  __washb_bd_diar.Rdata__, an R file of Bangladesh diarrheal disease data  
3.  __washb_bd_anthro.Rdata__, an R file of Bangladesh child anthropometry data  

Alse included in the package are two files of merged, cleaned, and subsetted data (as shown in this vignette) ready for the Bangladesh primary outcome analysis.  
4.  __washb_bd_diarClean.Rdata__, an R file of merged and clean Bangladesh enrollment and child diarrheal disease data  
5.  __washb_bd_anthroClean.Rdata__, an R file of merged and clean Bangladesh enrollment and child anthropometry data  


These datasets are included in the washb package and can be loaded with the data() command
Load here:
```{r, eval=FALSE}
data(washb_bd_enrol)
data(washb_bd_diar)

```
  

The following code cleans and merges the enrolment and diarrhea data:
```{r, results="hide", eval=FALSE}
# drop svydate and month because they are superceded in the child level diarrhea data
  washb_bd_enrol$svydate <- NULL
  washb_bd_enrol$month <- NULL

# merge the baseline dataset to the follow-up dataset
ad <- merge(washb_bd_enrol,washb_bd_diar,by=c("dataid","clusterid","block","tr"),all.x=F,all.y=T)

# subset to the relevant measurement
# Year 1 or Year 2
ad <- subset(ad,svy==1|svy==2)

#subset the diarrhea to children <36 mos at enrollment
### (exlude new births that are not target children)
ad <- subset(ad,sibnewbirth==0)
ad <- subset(ad,gt36mos==0)

# Exclude children with missing data
ad <- subset(ad,!is.na(ad$diar7d))

#Re-order the tr factor for convenience
ad$tr <- factor(ad$tr,levels=c("Control","Water","Sanitation","Handwashing","WSH","Nutrition","Nutrition + WSH"))

#Ensure that month is coded as a factor
ad$month <- factor(ad$month)

#Sort the data for perfect replication when using V-fold cross-validation
ad <- ad[order(ad$block,ad$clusterid,ad$dataid,ad$childid),]
```

```{r, eval=FALSE, include=FALSE}
#To do: merge in file to de-randomized treatment assignment 

data(washb_bd_diarScrambled)

data(treatmentAssignment)
#merge datasets
merged <- merge(washb_bd_diarScrambled,treatmentAssignment,by=c("index"),all.x=F,all.y=T)
#drop randomized treatment assignment

ad<-merged
```


```{r, include=FALSE}
data(washb_bd_diarClean)
ad<-washb_bd_diarClean
```
Now that the dataset is cleaned and merged, the washb package functions can be applied and the results will match the WASH Benefits Bangladesh primary analysis. (With the exception that the primary outcome analysis used TMLE, targeted maximum likelihood estimation, rather than GLM models in estimating the adjusted treatment effects.)  
Diarrheal data with the above cleaning steps applied is available in the __washb\_bd_diarClean.Rdata__ file, accessed with `data(washb_bd_diarClean)` Tables of the estimated treatment effects the primary Bangladesh outcomes (diarrheal disease and length-for-age Z-score), estimated using the functions in this package, are included at the end of this vignette.
  
  
#Function: wasb_prescreen  
Selects covariates with univariate associations with the outcome of P<0.2 based on a likelihood ratio test.
 * (Excluded from screening because only measured in target children: birthord)  
 * (Excluded from screening due to too many missing values: asset_clock, momheight)  

###Subset to a new dataframe the variables to be screened:
```{r , results = "hide" , cache=TRUE, comment=NA}

Ws <- subset(ad,select=c("fracode","month","agedays","sex","momage","momedu","momheight","hfiacat","Nlt18","Ncomp","watmin","elec","floor","walls","roof","asset_wardrobe","asset_table","asset_chair","asset_khat","asset_chouki","asset_tv","asset_refrig","asset_bike","asset_moto","asset_sewmach","asset_mobile"))

```

###Run the washb_prescreen function  
The washb\_prescreen function performs a likelihood ratio test on a set of potential covariates and returns all covariates with an associated p-value<0.2 (unless a custom pvalue is specified). It can be called as a function on its own, and is also called internally within the washb\_glm function. Unless otherwise specified by the use, the washb\_glm function with therefore only include covariates with a LR-test p-value <0.2 in the model. See the Function: washb_glm section for more details.
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
prescreened_varnames<-washb_prescreen(Y=ad$diar7d,Ws,family="binomial", pval=0.2)
```
  
__Description of output:__  
The function runs a likelihood ratio test between a generalized linear model fit to each screened variable and a null model. The first section of the output includes all screened variables and the p-values from the likelihood ratio test. The second section outputs only those variables with a p-value <0.2. The function does not currently support a user-defined p-value threshold.  
  
Use the following code to return the saved a list of variable names for the selected variables. Then, subset the covariate dataframe to only those variables:  
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
prescreened_varnames
prescreened_vars <- subset(Ws,select=prescreened_varnames)
#Examine the first five observations of the first selected variable:
prescreened_vars[1:5,1]

```  


#Function: washb_mean  
This function is most useful for calculating variable means and confidence intervals -- for example, calculating average compliance (uptake) within a given intervention arm, or calculating the average LAZ by arm or measurement round. In the WASH Benefits trials, the independent unit is typically the cluster, so the `id` argument should identify the cluster ID.  If you wish to actually compare means between groups using a difference, prevalence ratio, or incidence ratio (depending on the outcome), use washb\_ttest(for unadjusted continuous outcomes), or washb\_mh (for unadjusted binary outcomes), or washb\_glm for unadjusted or adjusted generalized linear models.  
  
Here, the mean and 95% Confidence interval for mother's age is calculated:
```{r, echo=FALSE, cache=TRUE, comment=NA}
washb_mean(Y=ad$momage,id=ad$clusterid,print=TRUE)
```


###Create vector of contrasts  
For the pre-specified hypothesis 1 (each intervention arm vs. control) to facilitate comparisons between arms.
```{r, comment=NA}
h1.contrasts <- list(
  c("Control","Water"),
  c("Control","Sanitation"),
  c("Control","Handwashing"),
  c("Control","WSH"),
  c("Control","Nutrition"),
  c("Control","Nutrition + WSH")
)
```



#Function: washb_mh
### Unadjusted Mantel-Haenszel estimates  
__Arguments:__
Y=binary outcome (in this example, Y= 7-day diarrheal disease recall `ad$diar7d`)  
tr=binary treatment group variable, comparison group first  
strat=stratification variable (In WASH Benefits: the pair-matched block variable)    
contrast= character vector of the format `c("contrast1", "contrast2")` of the two factor levels  within the treatment variable ("tr") to compare.    
measure=measure of effect. RR = prev ratio, RD = prev difference  

__Usage:__
`washb_mh(Y,tr,strat,contrast,measure="RR")`

Apply washb_mh to the water vs. control arm contrast. 
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
washb_mh(Y=ad$diar7d,tr=ad$tr, contrast=c("Control","Water"), strat=ad$block,measure="RR")
```
The function washb_mh can also be used to calculate an unadjusted risk difference: 
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
washb_mh(Y=ad$diar7d,tr=ad$tr, contrast=c("Control","Water"), strat=ad$block,measure="RD")
```
Use sapply command to efficiently apply the function to all the treatment arm contrasts
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
#Hypothesis 1
diff.h1 <- t(sapply(h1.contrasts,washb_mh,Y=ad$diar7d,tr=ad$tr,strat=ad$block,measure="RR"))
rownames(diff.h1) <- c("Water v C","Sanitation v C","Handwashing v C","WSH v C","Nutrition v C","Nutrition + WSH v C")
print(diff.h1)
```

#Function: washb_permute
#### Non-parametric unadjusted estimates (Wilcoxon Signed Rank permutation test)
WASH Benefits Wilcoxon Signed Rank permutation test function for two treatment arms conditional on randomization block. It conducts a permutation test of the independence of Y and tr, conditional on randomization block using the Wilcoxon rank-sum test statistic.  
__Usage:__ `washb_permute(Y,tr,pair,contrast,nreps=100000,seed=NULL)`  
__References:__
1.	Gail, M. H., Mark, S. D., Carroll, R. J., Green, S. B. & Pee, D. On Design Considerations and Randomization-Based Inference for Community Intervention Trials. Statist. Med. 15, 1069–1092 (1996).
 * [Link](http://onlinelibrary.wiley.com/doi/10.1002/(SICI)1097-0258(19960615)15:11%3c1069::AID-SIM220%3e3.0.CO%3b2-Q/full)
2.	Braun, T. M. & Feng, Z. Optimal Permutation Tests for the Analysis of Group Randomized Trials. Journal of the American Statistical Association 96, 1424–1432 (2001).
 * [Link](http://www.tandfonline.com/doi/abs/10.1198/016214501753382336)
3.	Rosenbaum, P. R. Covariance Adjustment in Randomized Experiments and Observational Studies. Statist. Sci. 17, 286–327 (2002).
 * [Link](http://projecteuclid.org/euclid.ss/1042727942)
  
Apply the washb_permute function to the Water-Control arm comparison:
```{r, eval=TRUE, warning=FALSE, message=FALSE, cache=TRUE, tidy=TRUE, comment=NA}
permute.C.W <- washb_permute(Y=ad$diar7d, tr=ad$tr, pair=ad$block, contrast=c("Control","Water"), nreps=100000, seed=242524)
```

Use sapply to apply the function across all arm comparisons, and assign results to matrices for hypothesis 1 and hypothesis 2 comparisons:
```{r, eval=TRUE, results = "hide", warning=FALSE, message=FALSE, cache=TRUE, tidy=TRUE, comment=NA}

permute.diff.h1<-t(sapply(h1.contrasts,washb_permute, Y=ad$diar7d, tr=ad$tr, pair=ad$block, nreps=10000, seed=12345))
rownames(permute.diff.h1) <- c("Water v C","Sanitation v C","Handwashing v C","WSH v C","Nutrition v C","Nutrition + WSH v C")
```

Examing the output across treatment arms:
```{r, eval=TRUE, warning=FALSE, message=FALSE, cache=TRUE, tidy=TRUE, comment=NA}
permute.diff.h1
```



#Function: washb_glm 
####Generalized linear model function for WASH Benefits study.
__Arguments:__
`Y`= Binary, count, or continious outcome   
`tr`= binary treatment group variable, comparison group first  
`pair`=stratification variable (In WASH Benefits: the pair-matched block variable)  
`W`=  Optional data frame that includes adjustment covariates (for adjusted estimates). `W` will be prescreened and only those associated with the outcome will be adjusted for. See washb_prescreen for more details. 
`forcedW=Optional vector of variable names to force as adjustment covariates (no screening)  
`V`= Optional variable name for subgroup analyses, which is interacted with `tr`. Continious variables can be used and an interaction term will be fit, but the calculated point estimates and confidence intervals for the treatment effect between subgroups will only be returned if V is a factor.
`id`= id of cluster used in calculating robust standard errors  
`contras`t= character vector of the format `c("contrast1", "contrast2")` of the two factor levels within the treatment variable ("tr") to compare.  
`family`=  GLM model family (gaussian, binomial, poisson, and negative binomial). Use "binonial(link='log')" to return prevalence ratios instead of odds ratios when the outcome is binary.  Use "neg.binom" for a Negative binomial model.
`pval= level of p=value to use in prescreening the set of potential adjustment variables W. Any variable in W with a likelihood ratio test p-value below this threshold will be included in the final adjustment set. Defaults to 0.2
`print`= logical (TRUE or FALSE, defaults to TRUE) for whether to print output or just store it in the assigned object.


__Usage:__ `washb_glm(Y,tr,pair,W=NULL, forcedW=NULL, V=NULL, id,contrast,family="binonial(link='log')", pval=0.2, print=TRUE)`

####Unadjusted GLM estimates for diarrheal disease outcome.

As an example, the following code applies the washb_glm function to compare just the water and control arms:
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}
glm.C.W <- washb_glm(Y=ad$diar7d,tr=ad$tr,pair=ad$block, id=ad$clusterid, contrast=c("Control","Water"), family=binomial(link='log'))

```

On top of the function's auto-printed output, the washb_glm function contains a number of objects. For example, `'objectname'$RDfit` returns the risk difference instead of the risk ratio for all covariates (not applicable when the glm  model is gaussian).
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}
glm.C.W$RDfit
```
All returned objects are:  
 * `'objectname'$TR` to return the treatment effect.
 * `'objectname$fit` to return full glm model estimates.
 * `'objectname$RDfit` to return the risk difference of the treatment (and all covariates, including block pairs).
 * `'objectname$vcv` to return the variance-covariance matrix.
 * `'objectname$rowdropped` to return the vector list of observations included in the model fit
 * `'objectname$lincom` to return subgroup-specific conditional relative risk estimates if a subgroup V is specified.
 * `'objectname$lincomRD` to return subgroup-specific conditional risk difference estimates if a subgroup V is specified.  

  
Use sapply to apply function across all pre-registered WASH Benefits arm comparisons:
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}

unadj.glm.h1 <- t(sapply(h1.contrasts,washb_glm,Y=ad$diar7d,tr=ad$tr,pair=ad$bloc, W=NULL, forcedW=NULL, V=NULL, id=ad$clusterid, family=binomial(link='log'), print=FALSE))
```

####Adjusted GLM
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}

adj.glm.h1 <- t(sapply(h1.contrasts,washb_glm,Y=ad$diar7d,tr=ad$tr,pair=ad$block, W=Ws, forcedW=NULL, V=NULL, id=ad$clusterid, family=binomial(link='log'), print=FALSE))
```
  
  
####Forcing covariates into the glm model regardless of prescreening p-value
If there are certain variables to include in the glm model, regardless of prescreening results, use the `forcedW` option. This argument takes a variable name or a vector of variable names. These variables must already be in the W dataframe of potential adjustment covariates. For example, if adjustment by age and sex is standard, force them into the glm model:
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}
glm.C.W <- washb_glm(Y=ad$diar7d,tr=ad$tr,pair=ad$block, W=Ws, forcedW=c("agedays","sex"), id=ad$clusterid, contrast=c("Control","Water"), family=binomial(link='log'))
```
  
  
#Subgroup analysis with GLM
The `V` arguement can be used to create an interaction term with `tr`, the treatment variable. `V` is a variable name of a variable that must be within the W matrix. Here is code for a subgroup analysis of the effect of water treatment on diarrheal disease, by target child (vs. sibling). 
```{r, warning=FALSE, message=FALSE, cache=TRUE, comment=NA}

#Create a W variable containing "tchild" and other potential covariates:
W_tchild <- subset(ad,select=c("tchild","month","agedays","sex","momage","momedu","momheight","hfiacat","Nlt18","Ncomp","watmin","elec","floor","walls","roof","asset_wardrobe","asset_table","asset_chair","asset_khat","asset_chouki","asset_tv","asset_refrig","asset_bike","asset_moto","asset_sewmach","asset_mobile"))


#Estimate subgroup analysis glm with washb_glm
glm.C.W.byChildType <- washb_glm(Y=ad$diar7d,tr=ad$tr,pair=ad$block, W=W_tchild, V="tchild", id=ad$clusterid, contrast=c("Control","Water"), family=binomial(link='log'), print=FALSE)

#Examine the treatment effect across subgroups with `objectname'$lincom
glm.C.W.byChildType$lincom

glm.byChildType <- lapply(h1.contrasts,washb_glm,Y=ad$diar7d,tr=ad$tr,pair=ad$block, W=W_tchild, forcedW=NULL, V="tchild", id=ad$clusterid, family=binomial(link='log'), print=FALSE)
```


###Diarrheal disease comparisons between treatment and control arms, stratified into target children and siblings.

Contrast v. control | Child Type | Coefficient |  95% CI  |  P-value  
--------------------|------------|-------------|----------|---------  
Water |`r glm.byChildType[[1]]$lincom[1,1]` | `r glm.byChildType[[1]]$lincom[1,2]` | `r round(glm.byChildType[[1]]$lincom[1,4:5],2)` | `r glm.byChildType[[1]]$lincom[1,7]`
- |`r glm.byChildType[[1]]$lincom[2,1]`  | `r glm.byChildType[[1]]$lincom[2,2]` | `r round(glm.byChildType[[1]]$lincom[2,4:5],2)` | `r glm.byChildType[[1]]$lincom[2,7]`
Sanitation |`r glm.byChildType[[2]]$lincom[1,1]` | `r glm.byChildType[[2]]$lincom[1,2]` | `r round(glm.byChildType[[2]]$lincom[1,4:5],2)` | `r glm.byChildType[[2]]$lincom[1,7]`
- |`r glm.byChildType[[2]]$lincom[2,1]`  | `r glm.byChildType[[2]]$lincom[2,2]` | `r round(glm.byChildType[[2]]$lincom[2,4:5],2)` | `r glm.byChildType[[2]]$lincom[2,7]`
Handwashing |`r glm.byChildType[[3]]$lincom[1,1]` | `r glm.byChildType[[3]]$lincom[1,2]` | `r round(glm.byChildType[[3]]$lincom[1,4:5],2)` | `r glm.byChildType[[3]]$lincom[1,7]`
- |`r glm.byChildType[[3]]$lincom[2,1]`  | `r glm.byChildType[[3]]$lincom[2,2]` | `r round(glm.byChildType[[3]]$lincom[2,4:5],2)` | `r glm.byChildType[[3]]$lincom[2,7]`
Nutrition |`r glm.byChildType[[4]]$lincom[1,1]` | `r glm.byChildType[[4]]$lincom[1,2]` | `r round(glm.byChildType[[4]]$lincom[1,4:5],2)` | `r glm.byChildType[[4]]$lincom[1,7]`
- |`r glm.byChildType[[4]]$lincom[2,1]`  | `r glm.byChildType[[4]]$lincom[2,2]` | `r round(glm.byChildType[[4]]$lincom[2,4:5],2)` | `r glm.byChildType[[4]]$lincom[2,7]`
WSH |`r glm.byChildType[[5]]$lincom[1,1]` | `r glm.byChildType[[5]]$lincom[1,2]` | `r round(glm.byChildType[[5]]$lincom[1,4:5],2)` | `r glm.byChildType[[5]]$lincom[1,7]`
- |`r glm.byChildType[[5]]$lincom[2,1]`  | `r glm.byChildType[[5]]$lincom[2,2]` | `r round(glm.byChildType[[5]]$lincom[2,4:5],2)` | `r glm.byChildType[[5]]$lincom[2,7]`
WSH+Nutrition |`r glm.byChildType[[6]]$lincom[1,1]` | `r glm.byChildType[[6]]$lincom[1,2]` | `r round(glm.byChildType[[6]]$lincom[1,4:5],2)` | `r glm.byChildType[[6]]$lincom[1,7]`
- |`r glm.byChildType[[6]]$lincom[2,1]`  | `r glm.byChildType[[6]]$lincom[2,2]` | `r round(glm.byChildType[[6]]$lincom[2,4:5],2)` | `r glm.byChildType[[6]]$lincom[2,7]`  

  
  
  
###Risk difference between treatment and control arms, stratified into target children and siblings.
Contrast v. control | Child Type | Coefficient |  95% CI  |  P-value  
--------------------|------------------------|-------------|----------|---------  
Water |`r glm.byChildType[[1]]$lincomRD[1,1]` | `r glm.byChildType[[1]]$lincomRD[1,2]` | `r round(glm.byChildType[[1]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[1]]$lincomRD[1,7]`
- |`r glm.byChildType[[1]]$lincomRD[2,1]`  | `r glm.byChildType[[1]]$lincomRD[2,2]` | `r round(glm.byChildType[[1]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[1]]$lincomRD[2,7]`
Sanitation |`r glm.byChildType[[2]]$lincomRD[1,1]` | `r glm.byChildType[[2]]$lincomRD[1,2]` | `r round(glm.byChildType[[2]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[2]]$lincomRD[1,7]`
- |`r glm.byChildType[[2]]$lincomRD[2,1]`  | `r glm.byChildType[[2]]$lincomRD[2,2]` | `r round(glm.byChildType[[2]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[2]]$lincomRD[2,7]`
Handwashing |`r glm.byChildType[[3]]$lincomRD[1,1]` | `r glm.byChildType[[3]]$lincomRD[1,2]` | `r round(glm.byChildType[[3]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[3]]$lincomRD[1,7]`
- |`r glm.byChildType[[3]]$lincomRD[2,1]`  | `r glm.byChildType[[3]]$lincomRD[2,2]` | `r round(glm.byChildType[[3]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[3]]$lincomRD[2,7]`
Nutrition |`r glm.byChildType[[4]]$lincomRD[1,1]` | `r glm.byChildType[[4]]$lincomRD[1,2]` | `r round(glm.byChildType[[4]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[4]]$lincomRD[1,7]`
- |`r glm.byChildType[[4]]$lincomRD[2,1]`  | `r glm.byChildType[[4]]$lincomRD[2,2]` | `r round(glm.byChildType[[4]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[4]]$lincomRD[2,7]`
WSH |`r glm.byChildType[[5]]$lincomRD[1,1]` | `r glm.byChildType[[5]]$lincomRD[1,2]` | `r round(glm.byChildType[[5]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[5]]$lincomRD[1,7]`
- |`r glm.byChildType[[5]]$lincomRD[2,1]`  | `r glm.byChildType[[5]]$lincomRD[2,2]` | `r round(glm.byChildType[[5]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[5]]$lincomRD[2,7]`
WSH + Nutrition |`r glm.byChildType[[6]]$lincomRD[1,1]` | `r glm.byChildType[[6]]$lincomRD[1,2]` | `r round(glm.byChildType[[6]]$lincomRD[1,4:5],2)` | `r glm.byChildType[[6]]$lincomRD[1,7]`
- |`r glm.byChildType[[6]]$lincomRD[2,1]`  | `r glm.byChildType[[6]]$lincomRD[2,2]` | `r round(glm.byChildType[[6]]$lincomRD[2,4:5],2)` | `r glm.byChildType[[6]]$lincomRD[2,7]`



#Function: washb_lincom
The subgroup analysis option in washb\_glm internally calls the washb\_lincom function to calculate estimates, SEs, CIs, and P-values from a linear combination of regression coefficients. The washb\_lincom function can be called alone to calculate a custom linear combination of coefficients. Below is an example comparing target children in the treatment arms whose household has assets associated with reduced diarrheal disease to siblings in the control arm whose households do not have these assets.

```{r, eval=TRUE, cache=TRUE, comment=NA}
#Fit the model
glm.C.N.byChildType <- washb_glm(Y=ad$diar7d,tr=ad$tr,pair=ad$block, W=W_tchild, V="tchild", id=ad$clusterid, contrast=c("Control","Nutrition"), family=binomial(link='log'), print=FALSE)
```

First, use the lincom function to verify the subgroup analysis calculated within the washb\_glm function. washb\_lincom takes as arguements the fit and variance-covariance matrix returned by the glm function, and an index vector `lc`.
`lc`= vector indexing coefficients to be linearly combined. If a single coefficient is chosen, it will return the same coefficient and confidence interval as the glm coefficient. Example:
```{r, eval=TRUE, cache=TRUE, comment=NA}
  #Create lc vector of 0's equal in length to the number of coefficients from the glm model.
lc=rep(0,nrow(glm.C.N.byChildType$fit))
  #Replace the second position in the vector with 1 (the position of the treatment coefficient in the model)
lc[2]<-1
  #Run the lincom function and compare output to the treatment effect from the GLM model.
washb_lincom(lc=lc,fit=glm.C.N.byChildType$fit,vcv=glm.C.N.byChildType$vcv, measure="RR") 
  #GLM model:
glm.C.N.byChildType$TR

#Now, the function will be used to compare target children in the nutrition arm with household assets to siblings in the control arm without household assets.
#Examine model coefficients (minus the pair-matched block estimates).
glm.C.N.byChildType$fit[1:29,]
#Create an index vector of treatment(2), target child(3), interaction term(4), watmin(22), elec(23), asset_table(26), asset_khat(27).
lc=rep(0,nrow(glm.C.N.byChildType$fit))
lc[c(2:4,22,23,26,27)]<-1
#Calculate combined prevalence ratio through the linear combination of model coefficients:
washb_lincom(lc=lc,fit=glm.C.N.byChildType$fit,vcv=glm.C.N.byChildType$vcv, measure="RR") 

#Calculate risk difference using the risk difference output from the washb_glm function:
washb_lincom(lc=lc,fit=glm.C.N.byChildType$RDfit,vcv=glm.C.N.byChildType$vcvRD, measure="RD") 

#Alternatively, use a character vector of coefficient names rather than an index vector of variable positions.
varlist<-c("trNutrition","month6","hfiacatSeverely Food Insecure")
washb_lincom(varlist=varlist,fit=glm.C.N.byChildType$RDfit,vcv=glm.C.N.byChildType$vcvRD, measure="RR") 

```



#LAZ Outcome Analysis  
  
Load and merge the anthropometry and enrollment datasets. and clean as for the diarheal disease analysis shown above (cleaning code ommitted)
```{r, eval=FALSE, comment=NA}
data(washb_bd_anthro)
data(washb_bd_enrol)
  washb_bd_enrol$svydate <- NULL
  washb_bd_enrol$month <- NULL
ad <- merge(washb_bd_enrol,washb_bd_anthro,by=c("dataid","clusterid","block","tr"),all.x=F,all.y=T)
ad <- subset(ad,svy==2)
ad <- subset(ad,tchild=="Target child")

# Drop children with extreme LAZ values
ad <- subset(ad,laz_x!=1)

ad$tr <- factor(ad$tr,levels=c("Control","Water","Sanitation","Handwashing","WSH","Nutrition","Nutrition + WSH"))
ad$month <- factor(ad$month)
ad <- ad[order(ad$block,ad$clusterid,ad$dataid,ad$childid),]

Ws <- subset(ad,select=c("fracode","month","aged","sex","birthord","momage","momedu","momheight","hfiacat","Nlt18","Ncomp","watmin","elec","floor","walls","roof","asset_wardrobe","asset_table","asset_chair","asset_khat","asset_chouki","asset_tv","asset_refrig","asset_bike","asset_moto","asset_sewmach","asset_mobile"))

```

```{r, include=FALSE, eval=TRUE, cache=TRUE, comment=NA}
data(washb_bd_anthroClean)
ad<-washb_bd_anthroClean

Ws <- subset(ad,select=c("fracode","month","aged","sex","birthord","momage","momedu","momheight","hfiacat","Nlt18","Ncomp","watmin","elec","floor","walls","roof","asset_wardrobe","asset_table","asset_chair","asset_khat","asset_chouki","asset_tv","asset_refrig","asset_bike","asset_moto","asset_sewmach","asset_mobile"))
```


#Function: washb_ttest  
Function to call the paired t-test for two different arms of the study. It estimates the paired t-test for differences in means paired within randomization blocks. This function should be used for the unadjusted analysis of continious outcomes.


```{r, cache=TRUE, comment=NA}
#Run washb_ttest on water vs. control arm comparison
washb_ttest(Y=ad$laz,tr=ad$tr,strat=ad$block, contrast=c("Control","Water"))

#Use sapply to apply across all contrasts
diff.h1LAZ <- t(sapply(h1.contrasts,washb_ttest,Y=ad$laz,tr=ad$tr,strat=ad$block))
rownames(diff.h1LAZ) <- c("Water v C","Sanitation v C","Handwashing v C","WSH v C","Nutrition v C","Nutrition + WSH v C")
```

#LAZ GLM Analysis  
####Estimating treatment effects for hypothesis 1 comparisons using unadjusted and adjusted gaussian linear models. Results are in the results table at the end of the document.
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}
#Unadjusted GLM
unadj.glm.h1LAZ <- lapply(h1.contrasts,washb_glm,Y=ad$laz,tr=ad$tr,pair=ad$block, W=NULL,forcedW=NULL, V=NULL, id=ad$clusterid, family="gaussian",print=FALSE)

#Adjusted GLM
adj.glm.h1LAZ <- lapply(h1.contrasts,washb_glm,Y=ad$laz,tr=ad$tr,pair=ad$block, W=Ws,forcedW=NULL, V=NULL, id=ad$clusterid, family="gaussian",print=FALSE)
```
  

####Subgroup analysis with multi-level factor
The `V` argument can be used with multilevel factors. Here is code for a subgroup analysis of the effect of water treatment on diarrheal disease, by target child (vs. sibling). 
```{r, warning=FALSE, message=FALSE, eval=T, cache=TRUE, comment=NA}
#Create a W variable containing only "hfiacat" for the unadjusted subgroup analysis:
W_hfiacat <- subset(ad,select=c("hfiacat"))

#Create a W variable containing "hfiacat" and other potential covariates:= for the adjusted subgroup analysis
Wsubgroup <- subset(ad,select=c("month","aged","sex","birthord","momage","momedu","momheight","hfiacat","Nlt18","Ncomp","watmin","elec","floor","walls","roof","asset_wardrobe","asset_table","asset_chair","asset_khat","asset_chouki","asset_tv","asset_refrig","asset_bike","asset_moto","asset_sewmach","asset_mobile"))


#Estimate subgroup analysis glm with washb_glm
glm.C.W.byFoodSecurity <- washb_glm(Y=ad$laz,tr=ad$tr,pair=ad$block, W=Wsubgroup, forcedW=NULL, V="hfiacat", id=ad$clusterid, contrast=c("Control","Water"), family="gaussian", print=FALSE)
glm.C.W.byFoodSecurity$lincom

```

```{r, eval=TRUE, cache=TRUE, comment=NA}
#Extend code to all treatment/control comparisons with lapply
#Unadjusted:
unadj.glm.byFoodSecurity <- lapply(h1.contrasts,washb_glm,Y=ad$laz,tr=ad$tr,pair=ad$block, W=W_hfiacat, forcedW=NULL, V="hfiacat", id=ad$clusterid, family="gaussian", print=FALSE)
#Adjusted
glm.byFoodSecurity <- lapply(h1.contrasts,washb_glm,Y=ad$laz,tr=ad$tr,pair=ad$block, W=Wsubgroup, forcedW=NULL, V="hfiacat", id=ad$clusterid, family="gaussian", print=FALSE)
```  

###LAZ comparisons between treatment and control arms, stratified by food security level.
Results from the washb_glm function run above with `V="hfiacat"`.

##Unadjusted
Contrast v. control | Food Security Subgroup | Coefficient |  95% CI  |  P-value  
--------------------|------------------------|-------------|----------|---------  
Water |`r unadj.glm.byFoodSecurity[[1]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[1]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[1]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[1]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[1]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[1]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[1]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[1]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[1]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[1]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[1]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[1]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[1]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[1]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[1]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[1]]$lincom[4,7]`
Sanitation |`r unadj.glm.byFoodSecurity[[2]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[2]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[2]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[2]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[2]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[2]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[2]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[2]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[2]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[2]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[2]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[2]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[2]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[2]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[2]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[2]]$lincom[4,7]`
Handwashing |`r unadj.glm.byFoodSecurity[[3]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[3]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[3]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[3]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[3]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[3]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[3]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[3]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[3]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[3]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[3]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[3]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[3]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[3]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[3]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[3]]$lincom[4,7]`
Nutrition |`r unadj.glm.byFoodSecurity[[4]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[4]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[4]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[4]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[4]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[4]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[4]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[4]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[4]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[4]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[4]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[4]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[4]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[4]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[4]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[4]]$lincom[4,7]`
WSH |`r unadj.glm.byFoodSecurity[[5]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[5]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[5]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[5]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[5]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[5]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[5]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[5]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[5]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[5]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[5]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[5]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[5]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[5]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[5]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[5]]$lincom[4,7]`
WSH + Nutrition |`r unadj.glm.byFoodSecurity[[6]]$lincom[1,1]` | `r unadj.glm.byFoodSecurity[[6]]$lincom[1,2]` | `r round(unadj.glm.byFoodSecurity[[6]]$lincom[1,4:5],2)` | `r unadj.glm.byFoodSecurity[[6]]$lincom[1,7]`
- |`r unadj.glm.byFoodSecurity[[6]]$lincom[2,1]`  | `r unadj.glm.byFoodSecurity[[6]]$lincom[2,2]` | `r round(unadj.glm.byFoodSecurity[[6]]$lincom[2,4:5],2)` | `r unadj.glm.byFoodSecurity[[6]]$lincom[2,7]`
- |`r unadj.glm.byFoodSecurity[[6]]$lincom[3,1]`  | `r unadj.glm.byFoodSecurity[[6]]$lincom[3,2]` | `r round(unadj.glm.byFoodSecurity[[6]]$lincom[3,4:5],2)` | `r unadj.glm.byFoodSecurity[[6]]$lincom[3,7]`
- |`r unadj.glm.byFoodSecurity[[6]]$lincom[4,1]`  | `r unadj.glm.byFoodSecurity[[6]]$lincom[4,2]` | `r round(unadj.glm.byFoodSecurity[[6]]$lincom[4,4:5],2)` | `r unadj.glm.byFoodSecurity[[6]]$lincom[4,7]`


##Adjusted

Contrast v. control | Food Security Subgroup | Coefficient |  95% CI  |  P-value  
--------------------|------------------------|-------------|----------|---------  
Water |`r glm.byFoodSecurity[[1]]$lincom[1,1]` | `r glm.byFoodSecurity[[1]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[1]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[1]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[1]]$lincom[2,1]`  | `r glm.byFoodSecurity[[1]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[1]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[1]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[1]]$lincom[3,1]`  | `r glm.byFoodSecurity[[1]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[1]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[1]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[1]]$lincom[4,1]`  | `r glm.byFoodSecurity[[1]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[1]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[1]]$lincom[4,7]`
Sanitation |`r glm.byFoodSecurity[[2]]$lincom[1,1]` | `r glm.byFoodSecurity[[2]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[2]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[2]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[2]]$lincom[2,1]`  | `r glm.byFoodSecurity[[2]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[2]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[2]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[2]]$lincom[3,1]`  | `r glm.byFoodSecurity[[2]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[2]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[2]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[2]]$lincom[4,1]`  | `r glm.byFoodSecurity[[2]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[2]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[2]]$lincom[4,7]`
Handwashing |`r glm.byFoodSecurity[[3]]$lincom[1,1]` | `r glm.byFoodSecurity[[3]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[3]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[3]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[3]]$lincom[2,1]`  | `r glm.byFoodSecurity[[3]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[3]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[3]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[3]]$lincom[3,1]`  | `r glm.byFoodSecurity[[3]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[3]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[3]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[3]]$lincom[4,1]`  | `r glm.byFoodSecurity[[3]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[3]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[3]]$lincom[4,7]`
Nutrition |`r glm.byFoodSecurity[[4]]$lincom[1,1]` | `r glm.byFoodSecurity[[4]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[4]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[4]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[4]]$lincom[2,1]`  | `r glm.byFoodSecurity[[4]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[4]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[4]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[4]]$lincom[3,1]`  | `r glm.byFoodSecurity[[4]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[4]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[4]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[4]]$lincom[4,1]`  | `r glm.byFoodSecurity[[4]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[4]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[4]]$lincom[4,7]`
WSH |`r glm.byFoodSecurity[[5]]$lincom[1,1]` | `r glm.byFoodSecurity[[5]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[5]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[5]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[5]]$lincom[2,1]`  | `r glm.byFoodSecurity[[5]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[5]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[5]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[5]]$lincom[3,1]`  | `r glm.byFoodSecurity[[5]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[5]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[5]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[5]]$lincom[4,1]`  | `r glm.byFoodSecurity[[5]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[5]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[5]]$lincom[4,7]`
WSH + Nutrition |`r glm.byFoodSecurity[[6]]$lincom[1,1]` | `r glm.byFoodSecurity[[6]]$lincom[1,2]` | `r round(glm.byFoodSecurity[[6]]$lincom[1,4:5],2)` | `r glm.byFoodSecurity[[6]]$lincom[1,7]`
- |`r glm.byFoodSecurity[[6]]$lincom[2,1]`  | `r glm.byFoodSecurity[[6]]$lincom[2,2]` | `r round(glm.byFoodSecurity[[6]]$lincom[2,4:5],2)` | `r glm.byFoodSecurity[[6]]$lincom[2,7]`
- |`r glm.byFoodSecurity[[6]]$lincom[3,1]`  | `r glm.byFoodSecurity[[6]]$lincom[3,2]` | `r round(glm.byFoodSecurity[[6]]$lincom[3,4:5],2)` | `r glm.byFoodSecurity[[6]]$lincom[3,7]`
- |`r glm.byFoodSecurity[[6]]$lincom[4,1]`  | `r glm.byFoodSecurity[[6]]$lincom[4,2]` | `r round(glm.byFoodSecurity[[6]]$lincom[4,4:5],2)` | `r glm.byFoodSecurity[[6]]$lincom[4,7]`


  
 
#Table of Primary Outcome Results  

###7-day diarrheal disease recall outcome  

Contrast v. control | Estimator | PR | 95% CI | SE logPR | P-value  
--------------------|-----------|----|--------|----------|--------  
Water | Unadjusted MH  | `r round(diff.h1[1,1],2)` | `r round((diff.h1[1,2:3]),2)` | `r round(diff.h1[1,5],2)` | `r round(diff.h1[1,7],4)`
Water | Unadjusted GLM |  `r round(unadj.glm.h1[[1]][1],2)` |(`r round(unadj.glm.h1[[1]][2:3],2)`) | `r round(unadj.glm.h1[[1]][5],4)` | `r round(unadj.glm.h1[[1]][7],4)`
Water | Adjusted GLM | `r round(adj.glm.h1[[1]][1],2)` |(`r round(adj.glm.h1[[1]][2:3],2)`) | `r round(adj.glm.h1[[1]][5],4)` | `r round(adj.glm.h1[[1]][7],4)`
Water | Adjusted GLM + TMLE |  | | | 
Water | Adjusted SL + TMLE |  | | |   
Water | Wilcoxon  permutation test |  | | |`r permute.diff.h1[1]` 
-----------------------------------------|--------------------------------------|---------------|-----------------------|------------|----------- 
Sanitation | Unadjusted MH  | `r round(diff.h1[2,1],2)` | `r round((diff.h1[2,2:3]),2)` | `r round(diff.h1[2,5],2)` | `r diff.h1[2,7]`
Sanitation | Unadjusted GLM |  `r round(unadj.glm.h1[[2]][1],2)` |(`r round(unadj.glm.h1[[2]][2:3],2)`) | `r round(unadj.glm.h1[[2]][5],4)` | `r unadj.glm.h1[[2]][7]`
Sanitation | Adjusted GLM | `r round(adj.glm.h1[[2]][1],2)` |(`r round(adj.glm.h1[[2]][2:3],2)`) | `r round(adj.glm.h1[[2]][5],4)` | `r (adj.glm.h1[[2]][7])`
Sanitation | Adjusted GLM + TMLE |  | | |- 
Sanitation | Adjusted SL + TMLE |  | | |-   
Sanitation | Wilcoxon  permutation test |  | | |`r permute.diff.h1[2]`  
-----------------------------------------|--------------------------------------|---------------|-----------------------|------------|-----------
Handwashing | Unadjusted MH  | `r round(diff.h1[3,1],2)` | `r round((diff.h1[3,2:3]),2)` | `r round(diff.h1[3,5],2)` | `r round(diff.h1[3,7],4)`
Handwashing | Unadjusted GLM |  `r round(unadj.glm.h1[[3]][1],2)` |(`r round(unadj.glm.h1[[3]][2:3],2)`) | `r round(unadj.glm.h1[[3]][5],4)` | `r round(unadj.glm.h1[[3]][7],4)`
Handwashing | Adjusted GLM | `r round(adj.glm.h1[[3]][1],2)` |(`r round(adj.glm.h1[[3]][2:3],2)`) | `r round(adj.glm.h1[[3]][5],4)` | `r round(adj.glm.h1[[3]][7],4)`
Handwashing | Adjusted GLM + TMLE |  | | | 
Handwashing | Adjusted SL + TMLE |  | | |   
Handwashing | Wilcoxon  permutation test |  | | |`r permute.diff.h1[3]`  
-----------------------------------------|--------------------------------------|---------------|-----------------------|------------|----------- 
Nutrition | Unadjusted MH  | `r round(diff.h1[4,1],2)` | `r round((diff.h1[4,2:3]),2)` | `r round(diff.h1[4,5],2)` | `r round(diff.h1[4,7],4)`
Nutrition | Unadjusted GLM |  `r round(unadj.glm.h1[[4]][1],2)` |(`r round(unadj.glm.h1[[4]][2:3],2)`) | `r round(unadj.glm.h1[[4]][5],4)` | `r round(unadj.glm.h1[[4]][7],4)`
Nutrition | Adjusted GLM | `r round(adj.glm.h1[[4]][1],2)` |(`r round(adj.glm.h1[[4]][2:3],2)`) | `r round(adj.glm.h1[[4]][5],4)` | `r round(adj.glm.h1[[4]][7],4)`
Nutrition | Adjusted GLM + TMLE |  | | | 
Nutrition | Adjusted SL + TMLE |  | | |   
Nutrition | Wilcoxon  permutation test |  | | |`r permute.diff.h1[4]` 
-----------------------------------------|--------------------------------------|---------------|-----------------------|------------|----------- 
WSH | Unadjusted MH  | `r round(diff.h1[5,1],2)` | `r round((diff.h1[5,2:3]),2)` | `r round(diff.h1[5,5],2)` | `r round(diff.h1[5,7],4)`
WSH | Unadjusted GLM |  `r round(unadj.glm.h1[[5]][1],2)` |(`r round(unadj.glm.h1[[5]][2:3],2)`) | `r round(unadj.glm.h1[[5]][5],4)` | `r round(unadj.glm.h1[[5]][7],4)`
WSH | Adjusted GLM | `r round(adj.glm.h1[[5]][1],2)` |(`r round(adj.glm.h1[[5]][2:3],2)`) | `r round(adj.glm.h1[[5]][5],4)` | `r round(adj.glm.h1[[5]][7],4)`
WSH | Adjusted GLM + TMLE |  | | | 
WSH | Adjusted SL + TMLE |  | | |   
WSH | Wilcoxon  permutation test |  | | |`r permute.diff.h1[5]` 
-----------------------------------------|--------------------------------------|---------------|-----------------------|------------|----------- 
WSH+Nutrition | Unadjusted MH  | `r round(diff.h1[6,1],2)` | `r round((diff.h1[6,2:3]),2)` | `r round(diff.h1[6,5],2)` | `r round(diff.h1[6,7],4)`
WSH+Nutrition | Unadjusted GLM |  `r round(unadj.glm.h1[[6]][1],2)` |(`r round(unadj.glm.h1[[6]][2:3],2)`) | `r round(unadj.glm.h1[[6]][5],4)` | `r round(unadj.glm.h1[[6]][7],4)`
WSH+Nutrition | Adjusted GLM | `r round(adj.glm.h1[[6]][1],2)` |(`r round(adj.glm.h1[[6]][2:3],2)`) | `r round(adj.glm.h1[[6]][5],4)` | `r round(adj.glm.h1[[6]][7],4)`
WSH+Nutrition | Adjusted GLM + TMLE |  | | | 
WSH+Nutrition | Adjusted SL + TMLE |  | | |   
WSH+Nutrition | Wilcoxon  permutation test |  | | |`r permute.diff.h1[6]` 

###Length-for-Age Z-score outcome  

Contrast v. control | Estimator | Difference | 95% CI | t-stat/SE | P-value
--------------------|-----------|------------|--------|-----------|--------
Water | Unadjusted ttest | `r round(diff.h1LAZ[1,1],2)` |(`r round((diff.h1LAZ[1,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[1,4],2)`| `r round(diff.h1LAZ[1,5],3)`
Water | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[1]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[1]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[1]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[1]]$TR[6],3)`
Water | Adjusted GLM | `r round(adj.glm.h1LAZ[[1]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[1]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[1]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[1]]$TR[6],3)`
Water | Adjusted GLM + TMLE |  | | | 
Water | Adjusted SL + TMLE |  | | | 
Water | Wilcoxon  permutation test |  | | | 
-----------------------------------------|--------------------------------------|---------------|--------------|------------|-------------
Sanitation | Unadjusted ttest | `r round(diff.h1LAZ[2,1],2)` |(`r round((diff.h1LAZ[2,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[2,4],2)`| `r round(diff.h1LAZ[2,5],3)`
Sanitation | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[2]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[2]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[2]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[2]]$TR[6],3)`
Sanitation | Adjusted GLM | `r round(adj.glm.h1LAZ[[2]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[2]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[2]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[2]]$TR[6],3)`
Sanitation | Adjusted GLM + TMLE |  | | | 
Sanitation | Adjusted SL + TMLE |  | | | 
Sanitation | Wilcoxon  permutation test |  | | | 
-----------------------------------------|--------------------------------------|---------------|--------------|------------|-------------
Handwashing | Unadjusted ttest | `r round(diff.h1LAZ[3,1],2)` |(`r round((diff.h1LAZ[3,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[3,4],2)`| `r round(diff.h1LAZ[3,5],3)`
Handwashing | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[3]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[3]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[3]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[3]]$TR[6],3)`
Handwashing | Adjusted GLM | `r round(adj.glm.h1LAZ[[3]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[3]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[3]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[3]]$TR[6],3)`
Handwashing | Adjusted GLM + TMLE |  | | | 
Handwashing | Adjusted SL + TMLE |  | | | 
Handwashing | Wilcoxon  permutation test |  | | | 
-----------------------------------------|--------------------------------------|---------------|--------------|------------|-------------
Nutrition | Unadjusted ttest | `r round(diff.h1LAZ[4,1],2)` |(`r round((diff.h1LAZ[4,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[4,4],2)`| `r round(diff.h1LAZ[4,5],3)`
Nutrition | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[4]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[4]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[4]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[4]]$TR[6],3)`
Nutrition | Adjusted GLM | `r round(adj.glm.h1LAZ[[5]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[5]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[5]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[5]]$TR[6],3)`
Nutrition | Adjusted GLM + TMLE |  | | | 
Nutrition | Adjusted SL + TMLE |  | | | 
Nutrition | Wilcoxon  permutation test |  | | | 
-----------------------------------------|--------------------------------------|---------------|--------------|------------|-------------
WSH | Unadjusted ttest | `r round(diff.h1LAZ[5,1],2)` |(`r round((diff.h1LAZ[5,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[5,4],2)`| `r round(diff.h1LAZ[5,5],3)`
WSH | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[5]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[5]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[5]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[5]]$TR[6],3)`
WSH | Adjusted GLM | `r round(adj.glm.h1LAZ[[5]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[5]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[5]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[5]]$TR[6],3)`
WSH | Adjusted GLM + TMLE |  | | | 
WSH | Adjusted SL + TMLE |  | | | 
WSH | Wilcoxon  permutation test |  | | | 
-----------------------------------------|--------------------------------------|---------------|--------------|------------|-------------
WSH+Nutrition | Unadjusted ttest | `r round(diff.h1LAZ[6,1],2)` |(`r round((diff.h1LAZ[6,2:3]),2)`) | t-stat:  `r round(diff.h1LAZ[6,4],2)`| `r round(diff.h1LAZ[6,5],3)`
WSH+Nutrition | Unadjusted GLM | `r round(unadj.glm.h1LAZ[[6]]$TR[1],2)` |(`r round(unadj.glm.h1LAZ[[6]]$TR[2:3],2)`) |SE:  `r round(unadj.glm.h1LAZ[[6]]$TR[4],2)` | `r round(unadj.glm.h1LAZ[[6]]$TR[6],3)`
WSH+Nutrition | Adjusted GLM | `r round(adj.glm.h1LAZ[[6]]$TR[1],2)` |(`r round(adj.glm.h1LAZ[[6]]$TR[2:3],2)`) |SE:  `r round(adj.glm.h1LAZ[[6]]$TR[4],2)` | `r round(adj.glm.h1LAZ[[6]]$TR[6],3)`
WSH+Nutrition | Adjusted GLM + TMLE |  | | | 
WSH+Nutrition | Adjusted SL + TMLE |  | | | 
WSH+Nutrition | Wilcoxon  permutation test |  | | | 

